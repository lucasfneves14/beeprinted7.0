<style>
.form-control::placeholder {
  color: #323232;  
}

.selector__button {
    width: 50%;
    align-items: center;
    border-radius: 3px;
    border: solid 1px rgba(0, 0, 23, 0.22);
    text-align: left;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    padding: 1rem 1rem 1rem 1.5rem;
    background-color: #fff;
    font-size: 17px;
}


</style>
<section id=cta class="padding-top-bottom color-bg light-typo" style='padding:20px;background-color:white; border-bottom: 1px solid rgba(0, 0, 18, 0.13);box-shadow: 0 0 10px 3px rgba(0,0,0,0.1);'>
<div class="container" style='margin-top:60px'>
  <div class="header">
    <h4 class="text-muted"><strong style='color:#009fab'>1.</strong> Você já possui os arquivos em 3D nas extensoes STL ou OBJ?</h4>
  </div> 

  <div style='display: flex;justify-content: flex-start; padding-top: 1.5rem; margin-bottom:20px'>
    <button class='selector__button text-muted' style='margin-right:5px' onClick='$(".orcamento").hide();$(".modelagem").fadeIn();'>
      <span>Ainda não! Não possuo os arquivos ou estão em outro formato.</span>
      <span class='modelagem' style='float:right;color:#009fab;display:none'>
        <i class="fa fa-check" aria-hidden="true" style='font-size:22px'></i>
      </span>
    </button>
    <button class='selector__button text-muted' style='margin-left:5px' onClick='$(".modelagem").hide();$(".orcamento").fadeIn();'>
      <span>Sim! Eu já possuo os arquivos em formato .STL ou .OBJ.</span>
      <span class='orcamento' style='float:right;color:#009fab;display:none'>
        <i class="fa fa-check" aria-hidden="true" style='font-size:22px'></i>
      </span>
    </button>
  
  </div>
</div>
</section>




<section style='min-height:600px'>

<div class="container orcamento" style='margin-top:40px; margin-bottom:20px;display:none'>

  <div class="header" style='margin-bottom:30px'>
    <h4 class="text-muted"><strong style='color:#009fab'>2.</strong> Faça o upload dos arquivos e descreva seu projeto</h4>
  </div> 
  <%= form_for(@arquivo, html: { multipart: true, novalidate:false, class: "dropzone", style:'border-radius:20px; border: 0px solid #009fab;box-shadow: 2px 2px #d2d2d2'}, remote:true) do |f|  %>
    <div class="dz-default dz-message" style='color:#009fab'><p><i class="fa fa-cloud-upload" style='font-size:64px'></i></p>
      <p><span><strong>Selecione ou arraste e solte arquivos STL ou OBJ para o seu projeto aqui</strong></span></p>
    </div>

    <div class="fallback", style='display:none'>
      <%= f.file_field :attachment %><br>
      <%= f.submit "Upload" %>
    </div>
  <% end %>
  <%if @orcamento.arquivos.any?%>
    <div class='dropzone' style='background-color:transparent;padding:0px;border:0px'>
      <%@orcamento.arquivos.each do |arquivo| %>
       <div class="dz-preview dz-file-preview dz-processing dz-success dz-complete" id="deletar-<%=arquivo.id%>">
        <div class="dz-image">
            <img data-dz-thumbnail="">
          </div>
          <div class="dz-details">
            <div class="dz-size">
              <span data-dz-size="">
                <strong><%='%.1f' % (arquivo.attachment.file.size/1000).round(1)%></strong> KB
              </span>
            </div>
            <div class="dz-filename">
              <span data-dz-name=""><%=File.basename(arquivo.attachment.path)%></span>
            </div>  
          </div>
          <div class="dz-progress">
            <span class="dz-upload" data-dz-uploadprogress="" style="width: 100%;"></span>
          </div>
          <div class="dz-error-message">
            <span data-dz-errormessage=""></span>
          </div>  
          <a class="dz-remove deletar-fora" href="javascript:undefined;" data-dz-remove="" id="<%=arquivo.id%>">Remover arquivo</a></div>
      <%end%>
      </div>
  <%end%>


  <%= simple_form_for @orcamento, html: { multipart: true, class:'' },style:'color:#616161' do |f| %>
    <%= f.error_notification%>
    <div class=w3-center><%= f.input :array, label: false,input_html:{style:'display:none'} %>
    </div>
    <div id='antesdoupload' style=''>
      <br>
      <div class=row>
        <h4>Observações (Descreva um pouco o seu projeto)</h4>
        <div class="form-group text-center" id="formgroup2">
          <%= f.input :description, label: false, placeholder: 'Características, cor, tipo de material, preferências nas técnicas de prototipagem e/ou qualquer dúvida...' , :input_html =>{:rows => "5"}%>
        </div>
      </div>
    </div>
    <hr class='hrbee'>
    <div class='container' style='text-align:right; margin-bottom: 15px'>
      <%=f.submit "Enviar Pedido de Orçamento", style:"font-weight:bold; font-size:16px; padding:15px", class:"btn btn-default dropdown-toggle font-bold w3-center", id:'button-orcamento' %>
    </div>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
  <%end%>
</div>







<div class="container modelagem" style='margin-top:40px; margin-bottom:20px;display:none'>

  <div class="header" style='margin-bottom:30px'>
    <h4 class="text-muted"><strong style='color:#009fab'>2.</strong> Faça o upload dos arquivos e descreva seu projeto</h4>
  </div> 
  <%= form_for(@reference, html: { multipart: true, novalidate:false, class: "dropzone", style:'border-radius:20px; border: 0px solid #009fab;box-shadow: 2px 2px #d2d2d2'}, remote:true) do |f|  %>
    <div class="dz-default dz-message" style='color:#009fab'><p><i class="fa fa-cloud-upload" style='font-size:64px'></i></p>
      <p><span><strong>Selecione ou arraste e solte arquivos de referência para o seu projeto aqui</strong></span></p>
    </div>

    <div class="fallback", style='display:none'>
      <%= f.file_field :attachment %><br>
      <%= f.submit "Upload" %>
    </div>
  <% end %>
  <%if @modeling.references.any?%>
    <div class='dropzone' style='background-color:transparent;padding:0px;border:0px'>
      <%@modeling.references.each do |reference| %>
       <div class="dz-preview dz-file-preview dz-processing dz-success dz-complete" id="deletar-<%=arquivo.id%>">
        <div class="dz-image">
            <img data-dz-thumbnail="">
          </div>
          <div class="dz-details">
            <div class="dz-size">
              <span data-dz-size="">
                <strong><%='%.1f' % (reference.attachment.file.size/1000).round(1)%></strong> KB
              </span>
            </div>
            <div class="dz-filename">
              <span data-dz-name=""><%=File.basename(reference.attachment.path)%></span>
            </div>  
          </div>
          <div class="dz-progress">
            <span class="dz-upload" data-dz-uploadprogress="" style="width: 100%;"></span>
          </div>
          <div class="dz-error-message">
            <span data-dz-errormessage=""></span>
          </div>  
          <a class="dz-remove deletar-fora" href="javascript:undefined;" data-dz-remove="" id="<%=reference.id%>">Remover arquivo</a></div>
      <%end%>
      </div>
  <%end%>


  <%= simple_form_for @modeling, html: { multipart: true, class:'' },style:'color:#616161' do |f| %>
    <%= f.error_notification%>
    <div class=w3-center><%= f.input :array, label: false,input_html:{style:'display:none'} %>
    </div>
    <div id='antesdoupload' style=''>
      <br>
      <div class=row>
        <h4>Observações (Descreva um pouco o seu projeto)</h4>
        <div class="form-group text-center" id="formgroup2">
          <%= f.input :description, label: false, placeholder: 'Características, cor, tipo de material, preferências nas técnicas de prototipagem e/ou qualquer dúvida...' , :input_html =>{:rows => "5"}%>
        </div>
      </div>
    </div>
    <hr class='hrbee'>
    <div class='container' style='text-align:right; margin-bottom: 15px'>
      <%=f.submit "Enviar Pedido de Orçamento", style:"font-weight:bold; font-size:16px; padding:15px", class:"btn btn-default dropdown-toggle font-bold w3-center", id:'button-orcamento' %>
    </div>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
  <%end%>
</div>
</section>



<%= content_for(:javascript) do %>
<script src="https://s3.amazonaws.com/beeprinted-stls/Revisao_Bee7.0/Assets/JS/dropzone.js"></script>
<script>
$(document).ready(function(){
  val = $('#orcamento_array').val();
  Dropzone.autoDiscover = false;
  var ids = [];
  <%if @orcamento.arquivos.any?%>
    <%@orcamento.arquivos.each do |arquivo| %>
      ids.push(<%=arquivo.id%>);
    <%end%>
  <%end%>
  $('#orcamento_array').val(ids);

  console.log("ASNAKD");
  console.log($('#orcamento_array').val());

  $('.deletar-fora').click(function(){ 

    var iddeletar = parseInt($(this).attr('id'));

     $.ajax({
        type: 'DELETE',
        url: '/arquivo/' + iddeletar,
        success: function(data){
          deletarID = 'deletar-' + iddeletar;
          $('#'+deletarID).hide();
          ids.splice( $.inArray(iddeletar,ids) ,1 );
          $('#orcamento_array').val(ids);
        }
      });
  });
  Dropzone.options.filedrop = {
      init: function () {
        this.on("queuecomplete", function (file) {
            alert("All files have uploaded ");
        });
      }
  };
  // grap our upload form by its id
  $("#new_arquivo").dropzone({
    // restrict image size to a maximum 1MB
    maxFilesize: 60,
    timeout: 0,
    // changed the passed param to one accepted by
    // our rails app
    paramName: "arquivo[attachment]",
    headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
    },
    // show remove links on each image upload
    addRemoveLinks: true,
    init: function () {

        this.on("queuecomplete", function (file) {
            $('#button-orcamento').show();
            console.log("Feito upload!");
        });
        this.on("addedfile", function (file) {
            $('#button-orcamento').hide();
            $('#antesdoupload').fadeIn();
            console.log("Adicionado");
        });
      },
    // if the upload was successful
    success: function(file, response){
      // find the remove button link of the uploaded file and give it an id
      // based of the fileID response from the server
      $(file.previewTemplate).find('.dz-remove').attr('id', response.fileID);
      deletarId = 'deletar-' + response.fileID;
      $(file.previewTemplate).find('.dz-image').parent().attr('id', deletarId);
      ids.push(response.fileID);
      $('#orcamento_array').val(ids);
      console.log($('#orcamento_array').val());
      // add the dz-success class (the green tick sign)
      $(file.previewElement).addClass("dz-success");
    },
    //when the remove button is clicked
    removedfile: function(file){
      // grap the id of the uploaded file we set earlier
      var id = parseInt($(file.previewTemplate).find('.dz-remove').attr('id'));
      // make a DELETE ajax request to delete the file
      $.ajax({
      	headers: {
        	'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
    	},
        type: 'DELETE',
        url: '/arquivo/' + id,
        success: function(data){
          console.log(data.message);
          deletarID = 'deletar-' + id;
          $('#'+deletarID).hide();
          console.log(ids);
          console.log(id);
          ids.splice( $.inArray(id,ids) ,1 );
          $('#orcamento_array').val(ids);
        }
      });
    }
  }); 
});
</script>






<script>
$(document).ready(function(){
  val = $('#modeling_array').val();
  Dropzone.autoDiscover = false;
  var ids = [];
  <%if @modeling.references.any?%>
    <%@modeling.references.each do |reference| %>
      ids.push(<%=reference.id%>);
    <%end%>
  <%end%>
  $('#modeling_array').val(ids);

  console.log("ASNAKD");
  console.log($('#modeling_array').val());

  $('.deletar-fora').click(function(){ 

    var iddeletar = parseInt($(this).attr('id'));

     $.ajax({
        type: 'DELETE',
        url: '/reference/' + iddeletar,
        success: function(data){
          deletarID = 'deletar-' + iddeletar;
          $('#'+deletarID).hide();
          ids.splice( $.inArray(iddeletar,ids) ,1 );
          $('#modeling_array').val(ids);
        }
      });
  });
  Dropzone.options.filedrop = {
      init: function () {
        this.on("queuecomplete", function (file) {
            alert("All files have uploaded ");
        });
      }
  };
  // grap our upload form by its id
  $("#new_reference").dropzone({
    // restrict image size to a maximum 1MB
    maxFilesize: 60,
    timeout: 0,
    // changed the passed param to one accepted by
    // our rails app
    paramName: "reference[attachment]",
    headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
    },
    // show remove links on each image upload
    addRemoveLinks: true,
    init: function () {

        this.on("queuecomplete", function (file) {
            $('#button-orcamento').show();
            console.log("Feito upload!");
        });
        this.on("addedfile", function (file) {
            $('#button-orcamento').hide();
            $('#antesdoupload').fadeIn();
            console.log("Adicionado");
        });
      },
    // if the upload was successful
    success: function(file, response){
      // find the remove button link of the uploaded file and give it an id
      // based of the fileID response from the server
      $(file.previewTemplate).find('.dz-remove').attr('id', response.fileID);
      deletarId = 'deletar-' + response.fileID;
      $(file.previewTemplate).find('.dz-image').parent().attr('id', deletarId);
      ids.push(response.fileID);
      $('#modeling_array').val(ids);
      console.log($('#modeling_array').val());
      // add the dz-success class (the green tick sign)
      $(file.previewElement).addClass("dz-success");
    },
    //when the remove button is clicked
    removedfile: function(file){
      // grap the id of the uploaded file we set earlier
      var id = parseInt($(file.previewTemplate).find('.dz-remove').attr('id'));
      // make a DELETE ajax request to delete the file
      $.ajax({
        headers: {
          'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
      },
        type: 'DELETE',
        url: '/reference/' + id,
        success: function(data){
          console.log(data.message);
          deletarID = 'deletar-' + id;
          $('#'+deletarID).hide();
          console.log(ids);
          console.log(id);
          ids.splice( $.inArray(id,ids) ,1 );
          $('#reference_array').val(ids);
        }
      });
    }
  }); 
});
</script>







<%end%>
